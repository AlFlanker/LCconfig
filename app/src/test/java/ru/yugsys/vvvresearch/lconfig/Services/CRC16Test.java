package ru.yugsys.vvvresearch.lconfig.Services;

import org.junit.Test;
import ru.yugsys.vvvresearch.lconfig.model.DataEntity.Device;

import java.io.IOException;
import java.util.Arrays;

import static org.junit.Assert.*;

//* @autor Alex Flanker
//* добавил 10 случайно сгенерированных строк и посчитал  http://crccalc.com/ CRC-16-EN-13757
public class CRC16Test {
    // test random string s
    static String[] testsLine = new String[]{
            "36B575BDD8B5178986108FCA6456412280B0519006BD3249C4760713655643FB4FD2F0D7AB28A8AD253848720630B190383DF000D5531D6C2AF4F2CD8BA20AA23306A558D016FA5F7B157A0BB0C6B8A06CD2619035C23701479F328362B821DDDD9F9AC4A43B9433D8AFC1D1C458B8502805C0A9B929704059",
            "0577B278CF6CD35368153B433959F951A3D974B7D5874527F0932AA1C178C7F2AA8183DC816559D33FF94625580001F891AF8B0BC0707D19623B2A1F780D7C087484DB86C36CBCD416298AC854618309D79B1DB9C0D0A690A04DAAA92798B8D3FAB7162240B4679B927377002386F0FC8D53181CAA2FA7B232",
            "BDB5FC2CD58424C185865B1CA2CF609888FC14748C37229D8303F6FC1127282225C6F938CD6FCD840C50C7149C6AAB39662B71B9D7C23FC33B24B06011FCA80B63FC32D9BD98C41F0B5BB6CC8F7068C32FC3205B1F73B336C4A666AD55900181D24D4CF9D6F40094BF95BA0A90F0CBC9856FC086B35D0398DB",
            "9B850420BFC7FAD143942BA4F5806200294D1F3C8052C0D307BA9F7792204B2D9D24399FAB42B465CC72D6CB0501C4B2FAA94F8617BBFBFB9219B10956D3034B9339FDF5A342176183CD43AB72011D805432AF0A41B10477697C0150568C2BCC70742C7B8693D14B66D3C075C078281BD22AA312D64B76F508",
            "2756B8D4196373F25B35818A877FB4368D91CC8659B7653FDDF9A403069BFD69FAB5767F93F268B239AA0258A223D2FDF8F3B93FD768CF820D3BB4C389716964012C7BC5CFFA5C92AC07047BA287534B21D4F50544367D9576908C79F7656B5F0ADF9A0491848637F388FD66869691A0220DFB01247DA02C91",
            "72B47262C953751411861535F7FAFADB7C715036B1C85FC5C12DF459264A45F451015DD8856BA27A80FC1AA65577D37208BC82C17A99459F8A886CA6658D168DC78897C18A1825FA5C7AB39A023A1004D05B727384DB1805CD4AA74238D360137F93537A0B4B873937361CFB23C15CC9A7D87A3C6584693C21",
            "AD56091B7D3B60B691BA4586262D83626425BD7FB215A40DA765F5846215B4617A15520D8CB23C83C0DBF3756C76509921B0B055562A80459A043C05F35306CFD66FF0242B259465A8C8B2A47A34A6A29D1C0F430D7D2B67951413921D9C146526889A61632F94A4CFAB7399383B82159FB14531504A32C107",
            "462999C306DB2880A39DAB8A2D8BF2DF980D7BB2287151C5D066A14AC9F04C1F0DC4D586DF15420D12217092DDF7536DACB786D3825C706A1D31003D61D7368130B4CB85BD297445B2DC1C291996A49A906AB08B8138B732139CBAA2D4703F4AA6F30A45F7496123B647A705BB26488543657B0180724083CB",
            "3C3170DB24589362F4AB991DDC2907D15B10F098886FB35B04443057731DFBAC2C5DA5AF0A3C047151B71359DD5CDF12721AB69051014612B50865B50FDC139BF304349B9DCF7D432CD150DD8FD412C115725AD2AC75AAD35537088AB240D08A78FCA6D5DBFF4BA04C4C5D1292680039FB064232B785504300",
            "235B738C407CFC229B885FD427D9270F4F2C17F43A2076550C582137438985B29899C4C8CA79957C7749AC243ABCDA88145FD8DC4F931D84F1B513497AA6110539F51A4955B1DF77A1773FC70060B596938C8978DAC64F782FDFC10D270A846844039C96F86859D2DB377019F043C37A43186D720DA3AD123C"
    };

    //http://crccalc.com/ CRC-16-EN-13757
    static String[] crc16 = new String[]{
            "29EE",
            "A73F",
            "8623",
            "D3EF",
            "18DE",
            "B4AD",
            "0FC0",
            "CA79",
            "1BC0",
            "2A77"
    };

    @Test
    public void CRC16ArrayGet() throws IllegalAccessException, IOException, ClassNotFoundException {
        //  hexToBytesTest();
        boolean check = true;
        byte[][] arr = new byte[10][242];
        String[] res = new String[10];
        for (int i = 0; i < 10; i++) {
            Device dev = Helper.decodeByteList(testsLine[i]);
            arr[i] = Helper.Object2ByteArray(dev);

        }
        char[] chars = new char[arr[0].length];
        CRC16 crc = new CRC16();
        int g = 0;
        for (int j = 0; j < 10; j++) {
            for (Byte bt : arr[j]) {
                chars[g++] = (char) (bt & 0x00FF);
            }
            g = 0;
            res[j] = String.format("%02X", crc.CRC16ArrayGet(0, chars) & 0x0000FFFF);

            if (res[j].length() < 4) {
                res[j] = "0" + res[j]; // !!!
            }

            if (!(res[j].equals(crc16[j]))) {
                check = false;
            }
        }

        assertTrue(Boolean.toString(check), check);
    }

}